function UIHandler(){this.init=function(){this.showeditor("text/plain","Welcome to S3ditor"),this.showLoginDialog()},this.login=function(){var e=$("#accessKey").val().trim(),t=$("#secretKey").val().trim(),o=$("#region").val().trim(),a=$("#bucketName").val().trim();s3ditor.getInstance().init(e,t,o,a),$("#loginDialog").modal("hide"),s3ditor.getInstance().loadFileListFromS3()},this.cleanUpLoginControls=function(){$("#accessKey").val(""),$("#secretKey").val(""),$("#bucketName").val("")},this.showLoginDialog=function(){$("#loginDialog").modal({backdrop:"static",keyboard:!1})},this.showMessageDialog=function(e,t,o){$("#message").html(t),$("#header").html(e),o||$("#messageDialogCloseButton").hide(),$("#messageDialog").modal({backdrop:"static",keyboard:!1})},this.showErrorMessageDialog=function(e){$("#message").html(e.message),$("#header").html(e.code),$("#messageDialogCloseButton").show(),$("#messageDialog").modal({backdrop:"static",keyboard:!1})},this.closeMessageDialog=function(e,t,o){$("#messageDialog").modal("hide")},this.showeditor=function(e,t){$("#directoryDialog").modal("hide");var o="html";t||(t=""),e?"text/css"==e?o="css":"text/html"==e?o="html":"application/x-javascript"==e&&(o="js"):o="html",editAreaLoader.init({id:"editArea",syntax:o,start_highlight:!0,allow_resize:"both",word_wrap:!0,language:"en",toolbar:"new_document, save, load, fullscreen,|, charmap, |, search, go_to_line, |, undo, redo, |, select_font, |, syntax_selection,  |, change_smooth_selection, highlight, reset_highlight, word_wrap,|, help",load_callback:"uiHandler.getInstance().showDirectory()",save_callback:"uiHandler.getInstance().save()",plugins:"charmap",charmap_default:"arrows",min_height:.9*window.innerHeight,allow_toggle:!1}),editAreaLoader.setValue("editArea",t)},this.showDirectory=function(){$("#directoryTree").treeview({data:this.getTree()}),$("#directoryTree").on("nodeSelected",function(e,t){s3ditor.getInstance().loadFileContents(t.text)}),$("#directoryDialog").modal()},this.openFile=function(e){this.showeditor(e)},this.save=function(){var e=editAreaLoader.getValue("editArea");s3ditor.getInstance().save(e)},this.getTree=function(){for(var e=s3ditor.getInstance().getBucketFileList(),t=[],o=0;o<e.length;o++)t[o]={},t[o].text=e[o];var a=[{text:s3ditor.getInstance().getBucketName(),nodes:t}];return a},this.convertFileListToTree=function(e){for(var t=e.sort(),o=[],a=([{text:s3ditor.getInstance().getBucketName(),nodes:o}],[]),i=[],n=0,r=0;r<t.length;r++){var s=t[r];a[r]={},a[r].isFolder=s.endsWith("/"),a[r].path=s;var l=a[r].path.split("/");a[r].isFolder?a[r].name=l[l.length-2]:(a[r].name=l[l.length-1],a[r].parentFolderName=l[l.length-2],a[r].parentFolderPath=l[l.length-2]),a[r].parentPath=a[r].path.substring(0,s.lastIndexOf(a[r].name)),a[r].isAddedToParent=!1,a[r].isFolder&&(a[r].enclosedfiles=[],a[r].enclosedFolders=[],i[n++]=a[r]),alert(r+" : "+a[r].toSource())}for(var n=0;n<i.length;n++){for(var r=0;r<a.length;r++)a[r].isAddedToParent||a[r].parentPath==i[n].path&&(a[r].isFolder?i[n].enclosedFolders.push(a[r]):a[r].enclosedfiles.push(a[r]),a[r].isAddedToParent=!0);alert(n+" : "+i[n].toSource())}for(var r=0;r<a.length;r++)!a[r].isAddedToParent;for(var r=0;r<folderNames.length;r++);}}var SEPARATOR=".",PATHSEPARATOR="/",uiHandler=function(){function e(){var e=new UIHandler;return e}var t;return{getInstance:function(){return t||(t=e()),t}}}();"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});
