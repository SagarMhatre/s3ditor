function UIHandler(){this.init=function(){this.showeditor("text/plain","Welcome to S3ditor"),this.showLoginDialog()},this.login=function(){var e=$("#accessKey").val().trim(),t=$("#secretKey").val().trim(),o=$("#region").val().trim(),a=$("#bucketName").val().trim();s3ditor.getInstance().init(e,t,o,a),$("#loginDialog").modal("hide"),s3ditor.getInstance().loadFileListFromS3()},this.cleanUpLoginControls=function(){$("#accessKey").val(""),$("#secretKey").val(""),$("#bucketName").val("")},this.showLoginDialog=function(){$("#loginDialog").modal({backdrop:"static",keyboard:!1})},this.showMessageDialog=function(e,t,o){$("#message").html(t),$("#header").html(e),o||$("#messageDialogCloseButton").hide(),$("#messageDialog").modal({backdrop:"static",keyboard:!1})},this.showErrorMessageDialog=function(e){var t=e.message;"NetworkingError"==e.code&&(t+=' : Please check if you have Enabled CORS for this domain on your bucket, given the right permissions to the user, selected the correct region & entered the correct bucket name. For more information, click <a href="README.html" target="_blank">Help</a>'),$("#message").html(t),$("#header").html(e.code),$("#messageDialogCloseButton").show(),$("#messageDialog").modal({backdrop:"static",keyboard:!1})},this.closeMessageDialog=function(e,t,o){$("#messageDialog").modal("hide")},this.showeditor=function(e,t){$("#directoryDialog").modal("hide");var o="html";t||(t=""),e?"text/css"==e?o="css":"text/html"==e?o="html":"application/x-javascript"==e&&(o="js"):o="html",editAreaLoader.init({id:"editArea",syntax:o,start_highlight:!0,allow_resize:"both",word_wrap:!0,language:"en",toolbar:"new_document, save, load, fullscreen,|, charmap, |, search, go_to_line, |, undo, redo, |, select_font, |, syntax_selection,  |, change_smooth_selection, highlight, reset_highlight, word_wrap,|, help",load_callback:"uiHandler.getInstance().showDirectory()",save_callback:"uiHandler.getInstance().save()",plugins:"charmap",charmap_default:"arrows",min_height:.9*window.innerHeight,allow_toggle:!1}),editAreaLoader.setValue("editArea",t)},this.showDirectory=function(){$("#directoryTree").treeview({data:this.getTree()}),$("#directoryTree").on("nodeSelected",function(e,t){s3ditor.getInstance().loadFileContents(t.text)}),$("#directoryDialog").modal()},this.openFile=function(e){this.showeditor(e)},this.save=function(){var e=editAreaLoader.getValue("editArea");s3ditor.getInstance().save(e)},this.getTree=function(){for(var e=s3ditor.getInstance().getBucketFileList(),t=[],o=0;o<e.length;o++)t[o]={},t[o].text=e[o];var a=[{text:s3ditor.getInstance().getBucketName(),nodes:t}];return a},this.convertFileListToTree=function(e){for(var t=e.sort(),o=[],a=([{text:s3ditor.getInstance().getBucketName(),nodes:o}],[]),i=[],r=0,n=0;n<t.length;n++){var s=t[n];a[n]={},a[n].isFolder=s.endsWith("/"),a[n].path=s;var l=a[n].path.split("/");a[n].isFolder?a[n].name=l[l.length-2]:(a[n].name=l[l.length-1],a[n].parentFolderName=l[l.length-2],a[n].parentFolderPath=l[l.length-2]),a[n].parentPath=a[n].path.substring(0,s.lastIndexOf(a[n].name)),a[n].isAddedToParent=!1,a[n].isFolder&&(a[n].enclosedfiles=[],a[n].enclosedFolders=[],i[r++]=a[n]),alert(n+" : "+a[n].toSource())}for(var r=0;r<i.length;r++){for(var n=0;n<a.length;n++)a[n].isAddedToParent||a[n].parentPath==i[r].path&&(a[n].isFolder?i[r].enclosedFolders.push(a[n]):a[n].enclosedfiles.push(a[n]),a[n].isAddedToParent=!0);alert(r+" : "+i[r].toSource())}for(var n=0;n<a.length;n++)!a[n].isAddedToParent;for(var n=0;n<folderNames.length;n++);}}var SEPARATOR=".",PATHSEPARATOR="/",uiHandler=function(){function e(){var e=new UIHandler;return e}var t;return{getInstance:function(){return t||(t=e()),t}}}();"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});
